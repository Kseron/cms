<?class Menu {var $select_menu;var $add_result;var $red_result;var $this_menu;var $list_menu;var $menu;function __construct() {	if($_GET['page'] == "add_menu" AND isset($_POST['submit']))	{		$this->add_menu();	}	elseif($_GET['page'] == "menu_list")	{		$this->show_menu();	}	elseif($_GET['page'] == "red_menu" AND $_GET['id'] != "")	{		if(isset($_POST['submit']))		{			$this->red_menu();		}				$array = mysql_fetch_array(mysql_query("SELECT * FROM menu WHERE id='$_GET[id]'"));		if($array[id] != "")		{			$this->this_menu = $array;		}	}	elseif($_GET['page'] == "del_menu" AND $_GET['id'] != "")	{		$query = mysql_query("DELETE FROM menu WHERE id='$_GET[id]'");	   	header('Location: '.$_SERVER[HTTP_REFERER]);	}	$this->create_select_menu();		$this->menu_in_site();		}function add_menu(){	if($_POST['title'] == "")	{		$this->add_result = "<script>alert('Вы не ввели название');</script>";	}	elseif($_POST['url'] == "")	{		$this->add_result = "<script>alert('Вы не ввели URL');</script>";	}	else	{		$check_parent = mysql_fetch_array(mysql_query("SELECT level FROM menu WHERE id='$_POST[position]'"));		if($check_parent['level'] != "")		{			$level = $check_parent['level'] + 1;		}		else		{			$level = 1;		}		$query = mysql_query("INSERT into menu SET title='$_POST[title]', url='$_POST[url]', level='$level', parent='$_POST[category]', position='$_POST[position]', vision='$_POST[vision]'");		if($query)		{			$this->add_result = "<script>alert('Пункт меню добавлен');</script>";		}	}}function red_menu(){	if($_POST['title'] == "")	{		$this->red_result = "<script>alert('Вы не ввели название');</script>";	}	elseif($_POST['url'] == "")	{		$this->red_result = "<script>alert('Вы не ввели URL');</script>";	}	elseif($_GET[id] != "")	{		$query = mysql_query("UPDATE menu SET title='$_POST[title]', url='$_POST[url]', parent='$_POST[category]', position='$_POST[position]',  vision='$_POST[vision]' WHERE id='$_GET[id]'");		if($query)		{			$this->red_result = "<script>alert('Пункт меню отредактирован');</script>";		}	}	else	{		$this->red_result = "<script>alert('В адресе страницы отсутствует id категории');</script>";	}}function show_menu(){	$query = mysql_query("SELECT * FROM menu WHERE parent='0' ORDER by position");	while($array = mysql_fetch_array($query))	{		$this->list_menu .= "<div class='first_level_category'><p><a href='$array[url]'>$array[title]</a>";		if($array[vision] == 0) { $this->list_menu .= "<span class='error_msg'>(hide)</span>"; }		$this->list_menu .= " : <a href='/red_menu/$array[id].html' class='a_light'>V</a> <a href='/del_menu/$array[id].html' class='a_light' onclick=\"return confirm('Вы уверены?')\">X</a></p>";		$query2 = mysql_query("SELECT * FROM menu WHERE parent='$array[id]' ORDER by position");		if(mysql_num_rows($query2) > 0)		{			while($array2 = mysql_fetch_array($query2))			{				$this->list_menu .= "<p class='two_level_category'><a href='$array2[url]'>$array2[title]</a>";				if($array2[vision] == 0) { $this->list_menu .= "<span class='error_msg'>(hide)</span>"; }				$this->list_menu .= " : <a href='/red_menu/$array2[id].html' class='a_light'>V</a> <a href='/del_menu/$array2[id].html' class='a_light' onclick=\"return confirm('Вы уверены?')\">X</a></p>";				$query3 = mysql_query("SELECT * FROM menu WHERE parent='$array2[id]' ORDER by position");				if(mysql_num_rows($query3) > 0)				{					while($array3 = mysql_fetch_array($query3))					{						$this->list_menu .= "<p class='three_level_category'><a href='$array3[url]'>$array3[title]</a>";						if($array3[vision] == 0) { $this->list_menu .= "<span class='error_msg'>(hide)</span>"; }						$this->list_menu .= " : <a href='/red_menu/$array3[id].html' class='a_light'>V</a> <a href='/del_menu/$array3[id].html' class='a_light' onclick=\"return confirm('Вы уверены?')\">X</a></p>";					}				}			}		}		$this->list_menu .= "</div>";	}	$query = mysql_query("SELECT * FROM menu WHERE parent!='0' ORDER by position");	while($array = mysql_fetch_array($query))	{		$query2 = mysql_query("SELECT * FROM menu WHERE id='$array[id]'");		if(mysql_num_rows($query2) < 1)		{			$this->list_menu .= "<p>Пункты «без родителей»:</p>";			while($array2 = mysql_fetch_array($query2))			{				$this->list_menu .= "<p class='two_level_category'><a href='$array2[url]'>$array2[title]</a>";				if($array2[vision] == 0) { $this->list_menu .= "<span class='error_msg'>(hide)</span>"; }				$this->list_menu .= " : <a href='/red_menu/$array2[id].html' class='a_light'>V</a> <a href='/del_menu/$array2[id].html' class='a_light' onclick=\"return confirm('Вы уверены?')\">X</a></p>";				/*				$query3 = mysql_query("SELECT * FROM menu WHERE parent='$array2[id]' ORDER by position");				if(mysql_num_rows($query3) > 0)				{					while($array3 = mysql_fetch_array($query3))					{						$this->list_menu .= "<p class='three_level_category'><a href='$array3[url]'>$array3[title]</a> : <a href='/red_menu/$array3[id]' class='a_light'>V</a> <a href='/del_menu/$array3/[id]' class='a_light' onclick=\"return confirm('Вы уверены?')\">X</a></p>";					}				}				*/			}		}	}}function menu_in_site(){	$this->menu = "<nav>	<ul id='nav'>";	$query = mysql_query("SELECT * FROM menu WHERE parent='0' AND vision='1' ORDER by position");	while($array = mysql_fetch_array($query))	{		$query2 = mysql_query("SELECT * FROM menu WHERE parent='$array[id]' AND vision='1' ORDER by position");		if(mysql_num_rows($query2) > 0)		{			$this->menu .= "			<li class='dropdown'><a href='$array[url]'>$array[title]</a>			<ul>";			while($array2 = mysql_fetch_array($query2))			{				$this->menu .= "				<li><a href='$array2[url]'>$array2[title]</a>";				$query3 = mysql_query("SELECT * FROM menu WHERE parent='$array2[id]' AND vision='1' ORDER by position");				if(mysql_num_rows($query3) > 0)				{					$this->menu .= "					<ul>";					while($array3 = mysql_fetch_array($query3))					{						$this->menu .= "						<li><a href='$array3[url]'>$array3[title]</a></li>";					}					$this->menu .= "					</ul>";				}				$this->menu .= "</li>";			}			$this->menu .= "			</ul>";		}		else		{			$this->menu .= "			<li><a href='$array[url]'>$array[title]</a>";		}		$this->menu .= "		</li>";	}	$this->menu .= "	</ul></nav>";}function create_select_menu(){	$this->select_menu = "<select name='category'>	<option value='0'></option>	";	$query = mysql_query("SELECT * FROM menu WHERE parent='0' ORDER by position");	while($array = mysql_fetch_array($query))	{		$this->select_menu .= "		<option value='$array[id]'";		if($this->this_menu['parent'] == $array[id]) { $this->select_menu .= " selected"; }		$this->select_menu .= ">$array[title]</option>";				$query2 = mysql_query("SELECT * FROM menu WHERE parent='$array[id]' ORDER by position");		while($array2 = mysql_fetch_array($query2))		{			$this->select_menu .= "			<option value='$array2[id]' style='padding-left:20px;'";			if($this->this_menu['parent'] == $array2[id]) { $this->select_menu .= " selected"; }			$this->select_menu .= "> $array2[title]</option>";						$query3 = mysql_query("SELECT * FROM menu WHERE parent='$array2[id]' ORDER by position");			while($array3 = mysql_fetch_array($query3))			{				$this->select_menu .= "				<option value='$array3[id]' style='padding-left:20px;'";				if($this->this_menu['parent'] == $array3[id]) { $this->select_menu .= " selected"; }				$this->select_menu .= "> —$array3[title]</option>";			}		}	}	$this->select_menu .= "</select>";}}