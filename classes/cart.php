<?class Cart {var $cart_list;var $orders_list;var $order_cart_list;var $one_order;var $user_orders;var $this_order;var $str_orders;var $order_confirm_result;var $error_confirm;var $add_result;var $delete_result;var $cart_sum = 0;var $num_rows = 0;function __construct() {	//$this->check_objects_in_cart();	if($_POST["add_cart"] != "" AND $_POST["product_id"] != "")	{		$this->add_to_cart();	}			if($_GET[page] == "cart" AND $_POST[order_submit] != "")	{		if($_POST[name] != "" AND $_POST[buyer] != "" AND $_POST[get] != "" AND $_POST[city] != "" AND $_POST[street] != "" AND $_POST[house] != "" AND		$_POST[mobile_operator] != "" AND $_POST[mobile_phone] != "")		{			if($_POST[cart_id] != "")			{				$this->order_confirm();			}			else			{				//$this->error_confirm = "<div class='error_msg'>В Вашей корзине нет ни одного товара</div>";				$this->error_confirm = "<script>alert('В Вашей корзине нет ни одного товара');</script>";			}		}		else		{			//$this->error_confirm = "<div class='error_msg'>Не все обязательные поля заполнены!</div>";			$this->error_confirm = "<script>alert('Не все обязательные поля заполнены!');</script>";			$this->make_cart();		}	}	elseif($_GET[page] == "cart")	{		$this->make_cart();		$this->delete_null_cart();	}	elseif($_GET[page] == "account" AND $_GET[type] == "orders")	{		$this->create_user_orders($_SESSION[user]);	}	elseif($_GET[page] == "order" AND $_GET[id] != "")	{		$this->get_order($_GET[id]);	}	elseif($_GET[page] == "orders")	{		$this->get_orders_list($_GET[user]);	}	elseif($_GET[page] == "change_status")	{		$this->change_status($_GET[id]);	}	elseif($_GET[page] == "red_order" AND $_GET[id] != "")	{		$this->red_order($_GET[id]);	}	elseif($_GET[page] == "del_from_cart" AND $_GET[id] != "")	{		$this->del_from_cart($_GET[id]);	}		$this->get_cart_sum();}function add_to_cart(){	for($i=0; $i<count($_POST["product_id"]); $i++)	{		if($_POST["product_id"][$i] != "" AND $_POST["count"][$i] != "0")		{			$array = mysql_fetch_array(mysql_query("SELECT prise FROM products WHERE id='".$_POST["product_id"][$i]."'"));			$product = $_POST["product_id"][$i];			$prise = $array[prise];			if($_SESSION[user] != "")			{				$check = mysql_query("SELECT * FROM cart WHERE user='$_SESSION[user]' AND product='$product'");			}			elseif($_COOKIE['anonym'] != "")			{				$check = mysql_query("SELECT * FROM cart WHERE anonym='$_COOKIE[anonym]' AND product='$product'");			}			else			{				$query = mysql_query("INSERT into anonymous SET browser='".$_SERVER['HTTP_USER_AGENT']."', datetime='".Date_time::get_date("datetime")."'");				$last_id = mysql_insert_id();				setcookie("anonym", $last_id, time()+2592000, "/");				//if($_COOKIE[anonym] == "")				//{				//	$this->cart_list = "<div class='error_msg'>Чтобы добавить товар в корзину Вам необходимо <a href='#register' class='register fancybox'>зарегистрироваться</a> на сайте, либо разрешить использование Coockie в своем браузере!</div>";				//}				$check = mysql_query("SELECT * FROM cart WHERE anonym='$last_id' AND product='$product'");			}						if(@mysql_num_rows($check) > 0)			{				$array_check = mysql_fetch_array($check);				$count = $_POST["count"][$i] + $array_check["count"];				$sum = $prise * $count;				$query = mysql_query("UPDATE cart SET count='$count', sum='$sum', datetime='".Date_time::get_date("datetime")."', ord='0', status='Предзаказ' WHERE id='$array_check[id]'");			}			else			{				$count = $_POST["count"][$i];				$sum = $prise * $count;				if($_SESSION[user] != "")				{					$query = mysql_query("INSERT into cart SET user='$_SESSION[user]', anonym='0', product='$product', count='$count', sum='$sum', datetime='".Date_time::get_date("datetime")."', ord='0', status='Предзаказ'");				}				elseif($_COOKIE['anonym'] != "")				{					$query = mysql_query("INSERT into cart SET user='0', anonym='$_COOKIE[anonym]', product='$product', count='$count', sum='$sum', datetime='".Date_time::get_date("datetime")."', ord='0', status='Предзаказ'");				}				else				{					$query = mysql_query("INSERT into cart SET user='0', anonym='$last_id', product='$product', count='$count', sum='$sum', datetime='".Date_time::get_date("datetime")."', ord='0', status='Предзаказ'");				}			}						if($query)			{				$this->add_result = "<div class='good_msg' style='font-size:1.3em; text-align:center;'>Товар добавлен в <a href='cart.html'>корзину</a>.</div>";			}			else			{				$this->add_result = "<div class='error_msg' style='font-size:1.3em; text-align:center;'>Чтобы добавить товар в корзину Вам необходимо <a href='#register' class='register fancybox'>зарегистрироваться</a> на сайте, либо разрешить использование Coockie в своем браузере!</div>";			}		}		/*$this->cart_list .= "$value<br />";*/	}}function delete_from_cart($id){	if($_SESSION[user] != "")	{		$check = mysql_query("SELECT id FROM cart WHERE user='$_SESSION[user]' AND id='$id' AND ord='0'");		if(mysql_num_rows($check) == 1)		{			mysql_query("DELETE FROM cart WHERE id='$id'");			//$this->delete_result = "удален товар из корзины";		}	}	elseif($_COOKIE[anonym] != "")	{		$check = mysql_query("SELECT id FROM cart WHERE anonym='$_COOKIE[anonym]' AND id='$id' AND ord='0'");		if(mysql_num_rows($check) == 1)		{			mysql_query("DELETE FROM cart WHERE id='$id'");			//$this->delete_result = "удален товар из корзины";		}	}	else	{		//$this->delete_result = "товар из корзины НЕ УДАЛЕН";	}		$this->get_cart_sum();	$this->delete_result = $this->cart_sum;}function make_cart(){	$this->cart_list .= "<h1>Содержимое вашей корзины</h1>";		if($_SESSION[user] != "")		{			$query = mysql_query("SELECT * FROM cart WHERE user='$_SESSION[user]' AND ord='0'");		}		elseif($_COOKIE['anonym'] != "")		{			$query = mysql_query("SELECT * FROM cart WHERE user='0' AND ord='0' AND anonym='".$_COOKIE['anonym']."'");		}				//$query = mysql_query("SELECT * FROM cart WHERE user='$_SESSION[user]' AND ord='0'");		if(@mysql_num_rows($query) > 0)		{			$this->cart_list .= "<table class='products' align='center'>			<tr class='title_tr'><td>&nbsp;</td> <td>Товар</td> <td>Количество</td> <td>Стоимость</td> <td>Сумма</td> <td>Действие</td></tr>";						while($array = mysql_fetch_array($query))			{				$product = mysql_fetch_array(mysql_query("SELECT * FROM products WHERE id='$array[product]'"));				$product_type = mysql_fetch_array(mysql_query("SELECT id, eng_title FROM product_types WHERE id='$product[product_type]'"));				//$good[eng_title] = str_replace(" ", "_", $good[eng_title]);				$summa = $array['count'] * $good['new_prise'];				$this->cart_list .= "<tr>				<td class='image'>";				if(file_exists("images/products/$product_type[id]/general-115x115.jpg"))				{					$this->cart_list .= "<a href='/product/$product_type[id]/$product_type[eng_title].html' rel='nofollow'><img src='images/products/$product_type[id]/general-115x115.jpg' alt='$good[title]'></a>";				}				elseif(file_exists("images/products/$product_type[id]/general-350x350.jpg"))				{					$this->cart_list .= "<a href='/product/$product_type[id]/$product_type[eng_title].html' rel='nofollow'><img src='images/products/$product_type[id]/general-350x350.jpg' alt='$good[title]'></a>";				}				elseif(file_exists("images/products/$product_type[id]/general-full.jpg"))				{					$this->cart_list .= "<a href='/product/$product_type[id]/$product_type[eng_title].html' rel='nofollow'><img src='images/products/$product_type[id]/general-full.jpg' alt='$good[title]'></a>";				}								$this->cart_list .= "</td>				<td><p><a href='/product/$product_type[id]/$product_type[eng_title].html'>$product[title]</a></p>				<p>Код товара: $product[code]</p></td>				<td><input type='hidden' name='cart_id[]' value='$array[id]'><input type='text' class='product_count' name='count[]' cart_id='$array[id]' product_id='$product[id]' size='3' value='$array[count]' maxlength='4'></td>				<td class='prise'><span>$product[prise]</span> руб.</td> <td class='summ'><span>$array[sum]</span> руб.</td>				<td align='center'><a class='del_product_from_cart fast_delete' cart_id='$array[id]' href='#' alt='Удалить' title='Удалить'> </a></td>				</tr>";								$big_summ += $array[sum];						}			$this->cart_list .= "<tr>			<td class='cart_confirm_td' colspan='4'>				Итого: <span>$big_summ</span> руб.			</td>			<td align='right' colspan='2'>				<input type='button' class='blue_button recalculate_cart' value='Пересчитать'>			</td>			</tr>			</table>";		}		else		{			$this->cart_list .= "<h2>Ваша корзина пуста. Положите в нее что-то чтобы заказать</h2>";		}}function order_confirm(){	$shipping_from = $_POST[year]."-".$_POST[mounth]."-".$_POST[day]." ".$_POST[from_time].":00:00";	$shipping_to = $_POST[year]."-".$_POST[mounth]."-".$_POST[day]." ".$_POST[to_time].":00:00";	$mobile_phone = "($_POST[mobile_operator])$_POST[mobile_phone]";	if($_POST[additional_phone] != "" AND $_POST[additional_operator] != "") { $additional_phone = "($_POST[additional_operator]) $_POST[additional_phone]"; }	mysql_query("INSERT into orders SET user='$_SESSION[user]', buyer='$_POST[buyer]', get='$_POST[get]', shipping_from='$shipping_from', shipping_to='$shipping_to', city='$_POST[city]', street='$_POST[street]', house='$_POST[house]', building='".$_POST['building']."', structure='$_POST[structure]', flat='$_POST[flat]', entrance='$_POST[entrance]', storey='".$_POST['storey']."', name='$_POST[name]', email='$_POST[email]', mobile_phone='$mobile_phone', additional_phone='$additional_phone', additional_info='$_POST[additional_info]', datetime='".Date_time::get_date('datetime')."', status='Pending', date_paid='0000-00-00 00:00:00'");	$order_id = mysql_insert_id();	if($order_id != 0)	{		$this->order_confirm_result .= "<div class='good_msg'>Заказ успешно оформлен. Скоро Вам перезвонит наш сотрудник</div>";		for($i=0; $i<count($_POST[cart_id]); $i++)		{			//$this->order_confirm_result .= "<p>".$_POST[cart_id][$i]."</p>";			mysql_query("UPDATE cart SET ord='$order_id' WHERE id='".$_POST[cart_id][$i]."'");		}				$admin_email = mysql_fetch_array(mysql_query("SELECT * FROM settings WHERE eng_title='admin_email'"));		if($_SESSION[user] != "" AND $_SESSION[login] != "")		{			$user = "Пользователь $_SESSION[login]";		}		else		{			$user = "Анонимный пользователь";		}		$message = "Добрый день.\n		$user сделал заказ №$order_id.\n		Просмотреть подробности заказа можно в среде системы администрации:\n		http://proba.kinofon.com.ua/admin/order/".$order_id.".html\n		\n";		mail($admin_email[value], "Новый заказ", $message,		"From: noreply@gipsa.ru\n"		."X-Mailer: PHP/" . phpversion()."\r\n"."Content-Type: text/plain; charset=UTF-8 \r\n");	}}function create_user_orders($id){	$query = mysql_query("SELECT * FROM orders WHERE user='$id'");	if(mysql_num_rows($query) > 0)	{		$this->user_orders = "<table class='user_orders'style='width:100%;'>";		$this->user_orders .= "<thead><tr><td>Статус</td><td>Номер заказа</td><td>Дата создания</td><td>Способ доставки</td><td>Стоимость, руб.</td></tr></thead>";		while($array = mysql_fetch_array($query))		{			$all_sum = 0;						$cart_query = mysql_query("SELECT * FROM cart WHERE ord='$array[id]'");			$this->order_cart_list .= "<h3>Товары:</h3>";			while($cart = mysql_fetch_array($cart_query))			{				$product = mysql_fetch_array(mysql_query("SELECT * FROM products WHERE id='$cart[product]'"));				$product_type = mysql_fetch_array(mysql_query("SELECT id, title, eng_title FROM product_types WHERE id='$product[product_type]'"));				$this->order_cart_list .= "<div style='overflow:hidden;'>";				if(file_exists("images/products/$product_type[id]/general-115x115.jpg"))				{					$this->order_cart_list .= "<a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'><img src='/images/products/$product_type[id]/general-115x115.jpg' alt='$product_type[title]' align='left'></a>";				}				$this->order_cart_list .= " <a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'>$product_type[title]</a><br />				<b>$cart[count] шт.</b> Х $product[prise] руб. = $cart[sum] руб.</div>";				$all_sum += $cart[sum];			}			$time_to = explode(" ", $array[shipping_to]);			$this->user_orders .= "			<tr>			<td>".$this->translate_status($array[status])."</td>			<td class='id'>#$array[id]</td>			<td>".Date_time::our_datetime_format($array[datetime])."</td>			<td>".$this->get_get($array[get])."</td>			<td>$all_sum руб.</td></tr>			<tr><td colspan='5' style='border-bottom:3px solid #E0E0E0;'>			<div class='spoiler'><div class='spoilerheader'>Подробнее</div>			<div class='spoilertext'>			<div style='overflow:hidden;'>			<div style='float:left;'>			<p><b>Заказчик:</b> $array[name], ".$this->get_buyer($array[buyer])."</p>			<p><b>Способ получения товара:</b> ".$this->get_get($array[get])."</p>			<p><b>Желательное время доставки:</b> ".Date_time::our_datetime_format($array[shipping_from])."-".$time_to[1]."</p>			<p><b>Телефон:</b> $array[mobile_phone]</p>			</div>			<div style='border:1px solid silver; padding:3px; float:right;'>			<h3>Адрес доставки</h3>			<p>$array[city], ул.$array[street]</p>";			if($array[building] != "") { $this->user_orders .= "<p><b>Корпус:</b> $array[building]</p>"; }			if($array[structure] != "") { $this->user_orders .= "<p><b>Строение:</b> $array[structure]</p>"; }			if($array[house] != "") { $this->user_orders .= "<p><b>Дом:</b> №$array[house]</p>"; }			if($array[entrance] != "") { $this->user_orders .= "<p><b>Подъезд:</b> $array[entrance]</p>"; }			if($array[storey] != "") { $this->user_orders .= "<p><b>Этаж:</b> $array[storey]</p>"; }			if($array[flat] != "") { $this->user_orders .= "<p><b>Квартира:</b> $array[flat]</p>"; }			$this->user_orders .= "			</div>			</div>			<div style='overflow:hidden;'>			".$this->order_cart_list."			</div>			</div>			</div></td></tr>";			$this->order_cart_list = "";		}		$this->user_orders .= "</table>";	}}function get_orders_list($user = "all"){	$str = $_GET[str];	if($_SESSION['access'] == 3)	{		if($user != "" AND $user != "all")		{			$stipulation .= " AND user='$user'";		}				$query = mysql_query("SELECT id FROM orders WHERE ( 1=1 )".$stipulation);		$num_rows_str = mysql_num_rows($query);			if($num_rows_str > 0)		{		//Сторінки		//$num_rows_str = mysql_num_rows($query);				$total = ceil($num_rows_str / 50);		if(empty($str) or $str < 0) { $str = 1; }		if($str > $total) { $str = $total; }		$str_start = $str * 50 - 50;				$storinka = "orders";		if($total < 3 )		{			$pervstr = ""; $nextstr = "";		}		else		{			// Проверяем нужны ли стрелки назад 			if ($str > 4) $pervstr = "<a href='".$storinka."/1.html'>1</a> ...";			// Проверяем нужны ли стрелки вперед 			if ( $str >= $total - 5) $nextstr = "";			elseif ($str != $total) $nextstr = "... <a href='".$storinka."/".$total.".html'>".$total."</a>"; 		}		// Находим дві ближайшие станицы с обоих краев, если они есть		if($str - 6 > 0) $str6left = '<a href='.$storinka.'/'. ($str - 6) .'.html>'. ($str - 6) .'</a>'; 		if($str - 5 > 0) $str5left = '<a href='.$storinka.'/'. ($str - 5) .'.html>'. ($str - 5) .'</a>'; 		if($str - 4 > 0) $str4left = '<a href='.$storinka.'/'. ($str - 4) .'.html>'. ($str - 4) .'</a>'; 		if($str - 3 > 0) $str3left = '<a href='.$storinka.'/'. ($str - 3) .'.html>'. ($str - 3) .'</a>'; 		if($str - 2 > 0) $str2left = '<a href='.$storinka.'/'. ($str - 2) .'.html>'. ($str - 2) .'</a>'; 		if($str - 1 > 0) $str1left = '<a href='.$storinka.'/'. ($str - 1) .'.html>'. ($str - 1) .'</a>'; 		if($str + 1 <= $total) $str1right = '<a href='.$storinka.'/'. ($str + 1) .'.html>'. ($str + 1) .'</a>';		if($str + 2 <= $total) $str2right = '<a href='.$storinka.'/'. ($str + 2) .'.html>'. ($str + 2) .'</a>';		if($str + 3 <= $total) $str3right = '<a href='.$storinka.'/'. ($str + 3) .'.html>'. ($str + 3) .'</a>';		if($str + 4 <= $total) $str4right = '<a href='.$storinka.'/'. ($str + 4) .'.html>'. ($str + 4) .'</a>';		if($str + 5 <= $total) $str5right = '<a href='.$storinka.'/'. ($str + 5) .'.html>'. ($str + 5) .'</a>';		if($str + 6 <= $total) $str6right = '<a href='.$storinka.'/'. ($str + 6) .'.html>'. ($str + 6) .'</a>';				$this->str_orders = "<div class='pages'> $pervstr";		if($str == $total) $this->str_orders .= "$str6left $str5left $str4left";		if($str == $total-1) $this->str_orders .= "$str5left $str4left";		if($str == $total-2) $this->str_orders .= "$str4left";		$this->str_orders .= " ".$str3left." ".$str2left." ".$str1left." <span>".$str."</span> ".$str1right." ".$str2right." ".$str3right." ";		if($str == 1) $this->str_orders .= " $str4right $str5right $str6right";		if($str == 2) $this->str_orders .= " $str4right $str5right";		if($str == 3) $this->str_orders .= " $str4right";		$this->str_orders .= " ".$nextstr."</div>";		$query = mysql_query("SELECT * FROM orders WHERE (1=1)".$stipulation." ORDER by datetime desc LIMIT $str_start, 50");		$this->orders_list = "<table class='admin_orders'>";		//$this->orders_list = "<tr class='title_tr'><td width='5%'>Заказ №</td><td width='13%'>Дата</td><td width='10%'>Заказчик</td><td>Сума</td> <td>Информация</td> <td>Статус</td> <td>Действия</td></tr>";		$this->orders_list .= "<tr class='title_tr'><td>Заказ №</td><td>Дата</td><td>Заказчик</td><td>Сума</td> <td>Информация</td> <td>Статус</td> <td>Действия</td></tr>";		while($array = mysql_fetch_array($query))		{			$all_sum = 0;			/*			$this->order_cart_list .= "<h3>Товары:</h3>			<table class='products'>			<tr><td></td> <td>Название</td><td>Колич.</td><td>Цена</td><td>Сумма</td></tr>";			*/						$cart_query = mysql_query("SELECT * FROM cart WHERE ord='$array[id]'");			while($cart = mysql_fetch_array($cart_query))			{				/*				$product = mysql_fetch_array(mysql_query("SELECT * FROM products WHERE id='$cart[product]'"));				$product_type = mysql_fetch_array(mysql_query("SELECT id, title, eng_title FROM product_types WHERE id='$product[product_type]'"));				$this->order_cart_list .= "<tr>";				if(file_exists("../images/products/$product_type[id]/general-115x115.jpg"))				{					$this->order_cart_list .= "<td><a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'><img src='/images/products/$product_type[id]/general-115x115.jpg' alt='$product_type[title]'></a></td>";				}				$this->order_cart_list .= "<td><a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'>$product_type[title]</a></td>				<td>$cart[count]</td> <td>$product[prise] руб.</td> <td>$cart[sum] руб.</td></tr>";				*/				$all_sum += $cart[sum];			}			//$this->order_cart_list .= "</table>";			$time_to = explode(" ", $array[shipping_to]);			$this->orders_list .= "			<tr>			<td class='id'>$array[id]</td>			<td>".Date_time::our_datetime_format($array[datetime])."</td>			<td>$array[name]</td>			<td>$all_sum руб.</td>			<td><p><b>Город:</b> $array[city]</p></td>";			if($array[status] == "Pending")			{				$this->orders_list .= "<td> <a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='gray_span'>".$this->translate_status($array[status])."</span></a></td>";			}			elseif($array[status] == "On_Hold")			{				$this->orders_list .= "<td> <a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='red_span'>".$this->translate_status($array[status])."</span></a></td>";			}			elseif($array[status] == "Closed")			{				$this->orders_list .= "<td> <a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='blue_span'>".$this->translate_status($array[status])."</span></a></td>";			}			$this->orders_list .= "			<td><a href='order/$array[id].html' class='blue_pseudobutton'>Подробнее</a> <a href='red_order/$array[id].html' class='blue_pseudobutton'>Редактировать</a></td></tr>";			/*			<tr><td colspan='7' style='border-bottom:3px solid #E0E0E0;'><div class='spoiler'><div class='spoilerheader'>Подробнее</div>			<div class='spoilertext'>			<p><b>Заказчик:</b> $array[name], ".$this->get_buyer($array[buyer])."</p>			<p><b>Способ получения товара:</b> ".$this->get_get($array[get])."</p>			<p><b>Желательное время доставки:</b> ".Date_time::our_datetime_format($array[shipping_from])."-".$time_to[1]."</p>			<p><b>Телефон:</b> $array[mobile_phone]</p>			<div style='border:1px solid silver; padding:3px;'>			<h3>Адрес доставки</h3>			<p>$array[city], ул.$array[street]</p>";			if($array[building] != "") { $this->orders_list .= "<p><b>Корпус:</b> $array[building]</p>"; }			if($array[structure] != "") { $this->orders_list .= "<p><b>Строение:</b> $array[structure]</p>"; }			if($array[house] != "") { $this->orders_list .= "<p><b>Дом:</b> №$array[house]</p>"; }			if($array[entrance] != "") { $this->orders_list .= "<p><b>Подъезд:</b> $array[entrance]</p>"; }			if($array[storey] != "") { $this->orders_list .= "<p><b>Этаж:</b> $array[storey]</p>"; }			if($array[flat] != "") { $this->orders_list .= "<p><b>Квартира:</b> $array[flat]</p>"; }			$this->orders_list .= "</div>				".$this->order_cart_list."</div>			</div></td></tr>";			$this->order_cart_list = "";			*/		}		$this->orders_list .= "</table>";		}	}}function get_order($id){	if($_SESSION[access] == 3)	{		$array = mysql_fetch_array(mysql_query("SELECT * FROM orders WHERE id='$id'"));	if($array[id] != "")	{		$this->this_order = $array;				//Список продуктов заказаніх в этом Заказе		$cart_query = mysql_query("SELECT * FROM cart WHERE ord='$array[id]'");		while($cart = mysql_fetch_array($cart_query))		{			$product = mysql_fetch_array(mysql_query("SELECT * FROM products WHERE id='$cart[product]'"));			$product_type = mysql_fetch_array(mysql_query("SELECT id, title, eng_title FROM product_types WHERE id='$product[product_type]'"));			$products .= "<tr>";			if(file_exists("../images/products/$product_type[id]/general-115x115.jpg"))			{				$products .= "<td><a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'><img src='/images/products/$product_type[id]/general-115x115.jpg' alt='$product_type[title]'></a></td>";			}			$products .= "<td><a href='/product/$product_type[id]/$product_type[eng_title].html' target='blank'>$product_type[title]</a></td>			<td>$cart[count]</td> <td>$product[prise] руб.</td> <td>$cart[sum] руб.</td>			<td align='center'><a class='fa fa-times no-decoration remove' href='del_from_cart/$cart[id].html' alt='Удалить' title='Удалить'> </a></td>			</tr>";			$all_sum += $cart[sum];		}				$time_to = explode(" ", $array[shipping_to]);		$this->one_order = "		<div style='width:100%; overflow:hidden; margin-bottom:10px;'>				<div class='yellow_block block' style='float:left; width:48%;'>		<div class='title'>Детали заказа <div class='tools'><a href='red_order/$id.html'><span class='fa fa-pencil-square-o'></span></a></div></div>		<div class='content'>			<div><p class='left'>Заказ №:</p> <p class='right'>".$array[id]."</p></div>			<div><p class='left'>Время:</p> <p class='right'>".Date_time::our_datetime_format($array[datetime])."</p></div>			<div><p class='left'>Статус:</p> <p class='right'>";			if($array[status] == "Pending")			{				$this->one_order .= "<a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='gray_span status' ord='$array[id]'>".$this->translate_status($array[status])."</span></a>";			}			elseif($array[status] == "On_Hold")			{				$this->one_order .= "<a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='red_span status' ord='$array[id]'>".$this->translate_status($array[status])."</span></a>";			}			elseif($array[status] == "Closed")			{				$this->one_order .= "<a href='change_status/$array[id].html' class='status' ord='$array[id]'><span class='blue_span status' ord='$array[id]'>".$this->translate_status($array[status])."</span></a>";			}					$this->one_order .= "</p></div>		<div><p class='left'>Сумма:</p> <p class='right'>$all_sum руб.</p></div>		</div>		</div>				<div class='hard_green_block block' style='float:right; width:48%;'>		<div class='title'>Информация о заказчике</div>		<div class='content'>			<div><p class='left'>Имя:</p> <p class='right'>".$array[name]."</p></div>			<div><p class='left'>Email:</p> <p class='right'>$array[email]</p></div>			<div><p class='left'>Мобильный телефон:</p> <p class='right'>$array[mobile_phone]</p></div>			<div><p class='left'>Дополнительный телефон:</p> <p class='right'>$array[additional_phone]</p></div>		</div>		</div>				</div>		<div style='width:100%; overflow:hidden;'>				<div class='gray_block block' style='float:left; width:48%;'>		<div class='title'>Адрес доставки</div>		<div class='content'>			<div><p class='left'>Город:</p> <p class='right'>$array[city]</p></div>			<div><p class='left'>Улица:</p> <p class='right'>$array[street]</p></div>";			if($array[building] != "") { $this->one_order .= "<div><p class='left'>Корпус:</p> <p class='right'>$array[building]</p></div>"; }			if($array[structure] != "") { $this->one_order .= "<div><p class='left'>Строение:</p> <p class='right'>$array[structure]</p></div>"; }			if($array[house] != "") { $this->one_order .= "<div><p class='left'>Дом:</p> <p class='right'>$array[house]</p></div>"; }			if($array[entrance] != "") { $this->one_order .= "<div><p class='left'>Подъезд:</p> <p class='right'>$array[entrance]</p></div>"; }			if($array[storey] != "") { $this->one_order .= "<div><p class='left'>Этаж:</p> <p class='right'>$array[storey]</p></div>"; }			if($array[flat] != "") { $this->one_order .= "<div><p class='left'>Квартира:</p> <p class='right'>$array[flat]</p></div>"; }		$this->one_order .= "		</div>		</div>				<div class='red_block block' style='float:right; width:48%;'>		<div class='title'>Детали</div>		<div class='content'>			<div><p class='left'>Удобное время:</p> <p class='right'>".Date_time::our_datetime_format($array[shipping_from])." - ".$time_to[1]."</p></div>			<div><p class='left'>Инфо:</p> <p class='right'>$array[additional_info]</p></div>		</div>		</div>				</div>				<h3>Товары:</h3>		<table class='products'>		<tr><td></td> <td>Название</td> <td>Колич.</td> <td>Цена</td> <td>Сумма</td> <td></td></tr>		".$products;		$this->one_order .= "</table>";	}		}}function red_order($id){	if($id != "" AND $_SESSION[access] == 3)	{		if($_POST[edith_order_submit] != "")		{			if($_POST[buyer] != "" AND $_POST[get] != "" AND $_POST[city] != "" AND $_POST[street] != "" AND $_POST[house] != "" AND $_POST[name] != "" AND $_POST[mobile_phone] != "")			{			$query = mysql_query("UPDATE orders SET buyer='$_POST[buyer]', get='$_POST[get]', shipping_from='$_POST[shipping_from]', shipping_to='$_POST[shipping_to]', city='$_POST[city]', street='$_POST[street]', house='$_POST[house]', building='$_POST[building]', structure='$_POST[structure]', flat='$_POST[flat]', entrance='$_POST[entrance]', storey='$_POST[storey]', name='$_POST[name]', email='$_POST[email]', mobile_phone='$_POST[mobile_phone]', additional_phone='$_POST[additional_phone]', additional_info='$_POST[additional_info]' WHERE id='$id'");			if($query)			{				$this->order_confirm_result .= "<div class='good_msg'>Заказ успешно отредактирован</div>";			}			else			{				$this->order_confirm_result .= "<div class='error_msg'>Ошибка записи в базу данных</div>";			}			}			else			{				$this->order_confirm_result .= "<div class='error_msg'>Не все обязательные поля заполнены</div>";			}		}						$array = mysql_fetch_array(mysql_query("SELECT * FROM orders WHERE id='$id'"));		$this->this_order = $array;	}}function change_status($id){	if($id != "" AND $_SESSION[access] = 3)	{		$order = mysql_fetch_array(mysql_query("SELECT status FROM orders WHERE id='$id'"));		if($order[status] != "")		{			if($order[status] == "Pending")			{				mysql_query("UPDATE orders SET status='Closed', date_paid='".Date_time::get_date("datetime")."' WHERE id='$id'");			}			elseif($order[status] == "Closed")			{				mysql_query("UPDATE orders SET status='Cancelled', date_paid='0000-00-00 00:00:00' WHERE id='$id'");			}			elseif($order[status] == "Cancelled")			{				mysql_query("UPDATE orders SET status='On_Hold', date_paid='0000-00-00 00:00:00' WHERE id='$id'");			}			elseif($order[status] == "On_Hold")			{				mysql_query("UPDATE orders SET status='Pending', date_paid='0000-00-00 00:00:00' WHERE id='$id'");			}		}	}	header("location:".$_SERVER[HTTP_REFERER]); }function delete_order($id){	if($id != "" AND $_SESSION['access'] == 3)	{		$query = mysql_query("DELETE FROM orders WHERE id='$id'");	}}function del_from_cart($id){	if($id != "" AND $_SESSION[access] = 3)	{		$query = mysql_query("DELETE FROM cart WHERE id='$id'");	}	header("location:".$_SERVER[HTTP_REFERER]); }function delete_null_cart(){	$query = mysql_query("DELETE FROM cart WHERE user='0' AND anonym='0'");}function get_cart_sum(){	$this->cart_sum = 0;	if($_SESSION[user] != "")	{		$query = mysql_query("SELECT sum FROM cart WHERE user='$_SESSION[user]' AND ord='0'");		while($array = mysql_fetch_array($query))		{			$this->cart_sum = $this->cart_sum + $array[sum];			$this->num_rows++;		}	}	elseif($_COOKIE[anonym] != "")	{		$query = mysql_query("SELECT sum FROM cart WHERE anonym='$_COOKIE[anonym]' AND ord='0'");		while($array = mysql_fetch_array($query))		{			$this->cart_sum = $this->cart_sum + $array[sum];			$this->num_rows++;		}	}}function translate_status($input){		switch($input)	{		case "Pending":		$output = "Ожидание";		break;				case "On_Hold":		$output = "Удержание";		break;				case "Closed":		$output = "Закрыто";		break;				case "Cancelled":		$output = "Отменено";		break;	}	return $output;}function get_buyer($input){	switch($input)	{		case "private":		$output = "частное лицо";		break;				case "organization":		$output = "организация";		break;	}	return $output;}function get_get($input){	switch($input)	{		case "shipping":		$output = "доставка";		break;				case "pickup":		$output = "самовывоз";		break;	}	return $output;}}