<?class Products {var $add_result;var $red_result;var $add_to_cart_result;var $this_product;var $one_product;var $list_products;var $index_list_product;var $str_list_products;var $filter_list;var $filter_select;var $filter_elements_select;var $products_on_str = 12;var $admin_list_products;function __construct() {	if($_GET['page'] == "add_product" AND isset($_POST['submit']))	{		$this->add_product();	}	elseif($_GET['page'] == "catalog")	{		$this->get_list_products();		$this->get_filters($_GET[id]);	}	elseif($_GET['page'] == "red_product" AND $_GET[id] != "")	{		$this->this_product= mysql_fetch_array(mysql_query("SELECT * FROM product_types WHERE id='$_GET[id]'"));		$category = mysql_fetch_array(mysql_query("SELECT eng_title FROM category WHERE id='".$this->this_good[category]."'"));		$this->this_product["my_category"] = $category["eng_title"];		if(isset($_POST['submit']))		{			$this->red_product();		}		if(isset($_POST['additional_images_submit']) AND isset($_FILES['additional_images']))		{			$this->add_additional_images($_GET[id]);		}	}	elseif($_GET[page] == "product" AND $_GET[id] != "")	{		$this->this_product= mysql_fetch_array(mysql_query("SELECT * FROM product_types WHERE id='$_GET[id]'"));		$this->get_one_product();	}	elseif($_GET[page] == "product" AND $_GET[title] != "")	{		$eng_title = str_replace("_", " ", $_GET[title]);		$this->this_product = mysql_fetch_array(mysql_query("SELECT * FROM product_types WHERE eng_title='$eng_title'"));		$this->get_one_product();	}	elseif($_GET[page] == "del_product" AND $_GET[id] != "" AND $_SESSION['user_type'] == 3)	{		$this->del_product($_GET[id]);		header("Location:'/';");	}	elseif($_GET[page] == "search" AND $_POST[search_text] != "")	{		$this->search($_POST[search_text]);	}	elseif($_GET[page] == "index" OR $_GET[page] == "")	{		$this->create_index_list_product();	}	elseif($_GET[page] == "product_list")	{		$this->create_admin_list_product();	}		if($_GET['page'] != "catalog")	{		$this->delete_cookie();	}	$this->create_filter_select();		if($_GET['page'] == "catalog")	{		$this->write_prises();	}	//$this->create_filter_elements_select();}function add_product(){	$eng_title = Functions::transliterate($_POST[title]);	$_POST[new_prise] = preg_replace("#[^\w.]#", "", $_POST[new_prise]);	$_POST[old_prise] = preg_replace("#[^\w.]#", "", $_POST[old_prise]);	if($_POST[title] != "" AND $_POST[category] != "")	{	$sql = mysql_query("INSERT into product_types SET title='$_POST[title]', eng_title='$eng_title', mini_description='$_POST[mini_description]', description='$_POST[description]', stats='$_POST[stats]', meta_title='$_POST[meta_title]', meta_description='$_POST[meta_description]', keywords='$_POST[keywords]', old_prise='$_POST[old_prise]', new_prise='$_POST[new_prise]', category='$_POST[category]', category2='$_POST[category2]', category3='$_POST[category3]', mark='', datetime='$_POST[datetime]', have='$_POST[have]', recommend='$_POST[recommend]', vision='$_POST[vision]'");	$this_id = mysql_insert_id();	if($sql)	{		$this->add_result = "<div class='good'>Товар добавлен</div>";				$image_file = $_FILES[image][tmp_name];		$image_file_name = $_FILES[image][name];				if($image_file != "")		{			//$good_name = str_replace(" ", "_", $eng_title);			Graphics::save_image($_FILES["image"]["tmp_name"], "../images/products/$this_id", "800", "general-full.jpg", "80");			Graphics::save_image($_FILES["image"]["tmp_name"], "../images/products/$this_id", "350", "general-350x350.jpg", "90");			Graphics::save_image($_FILES["image"]["tmp_name"], "../images/products/$this_id", "115", "general-115x115.jpg", "90");			Graphics::save_image($_FILES["image"]["tmp_name"], "../images/products/$this_id", "45", "general-45x45.jpg", "90");			if(file_exists("../images/products/$this_id/general-full.jpg"))			{				//Лепим ватермарк				//Graphics::get_watermark("images/products/$this_id/$good_name-full.jpg", "images/products/$this_id/general-full.jpg", "design/img/watermark.png", "80");				$this->add_result .= "<div class='good'>Картинка добавлена</div>";				//mysql_query("UPDATE product_types SET image='$good_name' WHERE id='$this_id'");			}			else			{				$this->add_result .= "<div class='error'>Картинка не добавлена</div>";				//mysql_query("UPDATE product_types SET image='0' WHERE id='$this_id'");			}		}				for($i=0; $i<=count($_POST[product_code]); $i++)		{			if($_POST[product_code][$i] != "" AND $_POST[product_title][$i] != "" AND $_POST[product_prise][$i] != "")			{				$_POST[product_code][$i] = preg_replace("#[^\w.]#", "", $_POST[product_code][$i]);				$_POST[product_prise][$i] = preg_replace("#[^\w.]#", "", $_POST[product_prise][$i]);				if($_POST[product_id][$i] != "")				{					mysql_query("UPDATE products SET product_type='".$this_id."', code='".$_POST[product_code][$i]."', title='".$_POST[product_title][$i]."', prise='".$_POST[product_prise][$i]."' WHERE id='".$_POST[product_id][$i]."'");				}				else				{					mysql_query("INSERT into products SET product_type='".$this_id."', code='".$_POST[product_code][$i]."', title='".$_POST[product_title][$i]."', prise='".$_POST[product_prise][$i]."'");				}			}		}				for($i=0; $i<=count($_POST[related_product_type]); $i++)		{			if($_POST[related_product_type][$i] != "")			{				$explode_related_product = explode(">", $_POST[related_product_type][$i]);				$id = trim($explode_related_product[0]);				if($id != "")				{					mysql_query("INSERT into related_products SET product_type1='".$this_id."', product_type2='".$id."'");				}			}		}				for($i=0; $i<=count($_POST[filter_product_type]); $i++)		{			if($_POST[filter_product_type][$i] != "" AND  $_POST[filter_element_product_type][$i] != "")			{								//Проверка на наличие самого фильтра и елемента фильтра. Если нету - добавляем@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter WHERE title='".$_POST[filter_product_type][$i]."'"));				if($check[id] == "")				{					mysql_query("INSERT into filter SET title='".$_POST[filter_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_product_type][$i])."', vision='1'");					$filter_id = mysql_insert_id();					mysql_query("INSERT into filter_elements SET title='".$_POST[filter_element_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_element_product_type][$i])."', filter='$filter_id'");										$filter_element_id = mysql_insert_id();				}				else				{					$filter_id = $check[id];@					$check_element = mysql_fetch_array(mysql_query("SELECT id FROM filter_elements WHERE title='".$_POST[filter_element_product_type][$i]."' AND filter='$check[id]'"));					if($check_element[id] == "")					{						mysql_query("INSERT into filter_elements SET title='".$_POST[filter_element_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_element_product_type][$i])."', filter='$check[id]'");											$filter_element_id = mysql_insert_id();					}					else					{						$filter_element_id = $check_element[id];					}				}								//Проверка не уже существующий ли фильтр. Если да - правим, если нужно				/*				if($_POST[filter_products_product_type][$i] != "")				{					$check = mysql_fetch_array(mysql_query("SELECT * FROM filter_products WHERE id='".$_POST[filter_products_product_type][$i]."'"));					if($check[id] != "")					{						mysql_query("UPDATE filter_products SET product_type='".$this_id."', filter='".."', element='' WHERE id='$check[id]'");						$filter_id = mysql_insert_id();						mysql_query("INSERT into filter_elements SET title='".$_POST[filter_element_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_element_product_type][$i])."', filter='$filter_id'");											$filter_element_id = mysql_insert_id();					}				}				*/												/* Прикрепление к товару */@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter_products WHERE product_type='$this_id' AND filter='$filter_id' AND element='$filter_element_id'"));				if($check[id] == "")				{					mysql_query("INSERT into filter_products SET product_type='$this_id', filter='$filter_id', element='$filter_element_id'");				}								/* Прикрепление к категории */@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter_cats WHERE category='$_POST[category]' AND filter='$filter_id'"));				if($check[id] == "")				{					mysql_query("INSERT into filter_cats SET category='$_POST[category]', filter='$filter_id'");				}			}		}				$_POST[title] = "";		$_POST[mini_description] = "";		$_POST[description] = "";		$_POST[stats] = "";		$_POST[meta_title] = "";		$_POST[mini_descr] = "";		$_POST[keywords] = "";				$_POST[product_code] = "";		$_POST[product_title] = "";		$_POST[product_prise] = "";				$_POST[related_product_type] = "";				$_POST[filter_product_type] = "";		$_POST[filter_element_product_type] = "";	}	else	{		$this->add_result = "<div class='error'>Товар недобавлен</div>";	}	}}function red_product(){	//$this->check_form();	//$eng_title = Functions::transliterate($_POST[title]);	//$_POST[new_prise] = preg_replace("#[^\w.]#", "", $_POST[new_prise]);	//$_POST[old_prise] = preg_replace("#[^\w.]#", "", $_POST[old_prise]);	$sql = mysql_query("UPDATE product_types SET title='$_POST[title]', mini_description='$_POST[mini_description]', description='$_POST[description]', stats='$_POST[stats]', meta_title='$_POST[meta_title]', meta_description='$_POST[meta_description]', keywords='$_POST[keywords]', old_prise='$_POST[old_prise]', new_prise='$_POST[new_prise]', category='$_POST[category]', category2='$_POST[category2]', category3='$_POST[category3]', mark='', datetime='$_POST[datetime]', have='$_POST[have]', recommend='$_POST[recommend]', vision='$_POST[vision]' WHERE id='$_GET[id]'");	if($sql)	{		$this->red_result = "<div class='good'>Товар отредактирован</div>";				$image_file = $_FILES[image][tmp_name];		$image_file_name = $_FILES[image][name];				if($_POST[delete_image] == "1")		{			//$good_name = str_replace(" ", "_", $_POST[eng_title]);@			unlink("images/products/$_GET[id]/general-full.jpg");@			unlink("images/products/$_GET[id]/general-350x350.jpg");@			unlink("images/products/$_GET[id]/general-115x115.jpg");@			unlink("images/products/$_GET[id]/general-45x45.jpg");			//Graphics::dirDel("images/products/$_GET[id]");			mysql_query("UPDATE product_types SET image='0' WHERE id='$_GET[id]'");		}		elseif($image_file != "")		{			//$good_name = str_replace(" ", "_", $_POST[eng_title]);			Graphics::save_image($_FILES["image"]["tmp_name"], "images/products/$_GET[id]", "800", "general-full.jpg", "80");			Graphics::save_image($_FILES["image"]["tmp_name"], "images/products/$_GET[id]", "350", "general-350x350.jpg", "90");			Graphics::save_image($_FILES["image"]["tmp_name"], "images/products/$_GET[id]", "115", "general-115x115.jpg", "90");			Graphics::save_image($_FILES["image"]["tmp_name"], "images/products/$_GET[id]", "45", "general-45x45.jpg", "90");			if(file_exists("images/products/$_GET[id]/general-full.jpg"))			{				//Лепим ватермарк				//Graphics::get_watermark("images/products/$_GET[id]/$good_name-full.jpg", "images/products/$_GET[id]/general-full.jpg", "design/img/watermark.png", "80");				$this->red_result .= "<div class='good'>Картинка добавлена</div>";				mysql_query("UPDATE product_types SET image='$good_name' WHERE id='$_GET[id]'");			}			else			{				$this->red_result .= "<div class='error'>Картинка не добавлена</div>";				mysql_query("UPDATE product_types SET image='0' WHERE id='$_GET[id]'");			}		}		for($i=0; $i<=count($_POST[product_code]); $i++)		{			if($_POST[product_code][$i] != "" AND $_POST[product_title][$i] != "" AND $_POST[product_prise][$i] != "")			{				$_POST[product_code][$i] = preg_replace("#[^\w.]#", "", $_POST[product_code][$i]);				$_POST[product_prise][$i] = preg_replace("#[^\w.]#", "", $_POST[product_prise][$i]);				if($_POST[product_id][$i] != "")				{					mysql_query("UPDATE products SET product_type='".$_GET[id]."', code='".$_POST[product_code][$i]."', title='".$_POST[product_title][$i]."', prise='".$_POST[product_prise][$i]."' WHERE id='".$_POST[product_id][$i]."'");				}				else				{					mysql_query("INSERT into products SET product_type='".$_GET[id]."', code='".$_POST[product_code][$i]."', title='".$_POST[product_title][$i]."', prise='".$_POST[product_prise][$i]."'");				}			}		}		for($i=0; $i<=count($_POST[related_product_type]); $i++)		{			if($_POST[related_product_type][$i] != "")			{				$explode_related_product = explode(">", $_POST[related_product_type][$i]);				$id = trim($explode_related_product[0]);				if($id != "")				{					$check = mysql_fetch_array(mysql_query("SELECT id FROM related_products WHERE product_type2='$id'"));					if($check[id] == "")					{						//mysql_query("UPDATE related_products SET product_type2='$id' WHERE id='$check[id]'");					//}					//else					//{						mysql_query("INSERT into related_products SET product_type1='".$_GET[id]."', product_type2='".$id."'");					}				}			}		}		for($i=0; $i<=count($_POST[filter_product_type]); $i++)		{			if($_POST[filter_product_type][$i] != "" AND  $_POST[filter_element_product_type][$i] != "")			{								//Проверка на наличие самого фильтра и елемента фильтра. Если нету - добавляем@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter WHERE title='".$_POST[filter_product_type][$i]."'"));				if($check[id] == "")				{					mysql_query("INSERT into filter SET title='".$_POST[filter_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_product_type][$i])."', vision='1'");					$filter_id = mysql_insert_id();					mysql_query("INSERT into filter_elements SET title='".$_POST[filter_element_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_element_product_type][$i])."', filter='$filter_id'");										$filter_element_id = mysql_insert_id();				}				else				{					$filter_id = $check[id];@					$check_element = mysql_fetch_array(mysql_query("SELECT id FROM filter_elements WHERE title='".$_POST[filter_element_product_type][$i]."' AND filter='$check[id]'"));					if($check_element[id] == "")					{						mysql_query("INSERT into filter_elements SET title='".$_POST[filter_element_product_type][$i]."', eng_title='".Functions::transliterate($_POST[filter_element_product_type][$i])."', filter='$check[id]'");											$filter_element_id = mysql_insert_id();					}					else					{						$filter_element_id = $check_element[id];					}				}									/* Прикрепление к товару */@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter_products WHERE product_type='$_GET[id]' AND filter='$filter_id' AND element='$filter_element_id'"));				if($check[id] == "")				{					mysql_query("INSERT into filter_products SET product_type='$_GET[id]', filter='$filter_id', element='$filter_element_id'");				}								/* Прикрепление к категории */@				$check = mysql_fetch_array(mysql_query("SELECT id FROM filter_cats WHERE category='$_POST[category]' AND filter='$filter_id'"));				if($check[id] == "")				{					mysql_query("INSERT into filter_cats SET category='$_POST[category]', filter='$filter_id'");				}			}		}	}	else	{		$this->red_result = "<div class='error'>Товар неотредактирован</div>";	}}function add_additional_images($id){	if($_FILES['additional_images'] != "")	{		$array = mysql_fetch_array(mysql_query("SELECT eng_title FROM product_types WHERE id='$id'"));		$image_file = $_FILES['additional_images']['tmp_name'];		$image_file_name = $_FILES['additional_images']['name'];		$good_name = str_replace(" ", "_", $array[eng_title]);		if($image_file != "")			{				mysql_query("INSERT into goods_images SET good='$id',  name='$good_name', datetime='".Date_time::get_date('datetime')."'");				$last_id = mysql_insert_id();				Graphics::save_image($image_file, "images/products/$id", "800", "$last_id-full.jpg", "80");				Graphics::save_image($image_file, "images/products/$id", "115", "$last_id-115x115.jpg", "90");				Graphics::save_image($image_file, "images/products/$id", "45", "$last_id-45x45.jpg", "90");								if(file_exists("images/products/$id/$good_name-$last_id-full.jpg"))				{					//Graphics::get_watermark("images/products/$id/$good_name-$last_id-full.jpg", "images/products/$id/$good_name-$last_id-full.jpg", "design/img/watermark.png", "80");					$this->red_result .= "<div class='good'>Картинка $last_id добавлена</div>";				}			}			}}function del_product($id){	if($_SESSION['user_type'] == 3) //Проверка на админа	{		$product = mysql_fetch_array(mysql_query("SELECT id FROM goods WHERE id='$id'"));		if($product[id] != "")		{			$query = mysql_query("DELETE FROM goods_images WHERE good='$id'");			if($query)			{				Functions::removeDirectory("/images/products/$id");				//rmdir("/images/products/$id");				//mysql_query("DELETE FROM goods WHERE id='$id'");			}		}	}}function get_list_products(){	if($_GET[id] != "")	{		$cat = mysql_fetch_array(mysql_query("SELECT * FROM category WHERE id='$_GET[id]'"));		if($cat[id] != "" AND $cat['parent'] == 0)		{			$this->list_products .="<h1>$cat[title]</h1>";			$children_cats = mysql_query("SELECT * FROM category WHERE parent='$cat[id]' AND vision='1'");			while($child = mysql_fetch_array($children_cats))			{				$this->list_products .="<div class='mini_cat'>					<div class='mini_cat_image' style='background-image:url(/images/catalog/$child[id]/$child[eng_title]-135x135.jpg);'>						<a class='big_a' href='/catalog/$child[id]/$child[eng_title].html' rel='nofollow'></a>					</div>					<div class='mini_cat_title'><a href='/catalog/$child[id]/$child[eng_title].html'>$child[title]</a></div>				</div>";			}			$this->list_products .="			<div class='cat_description'>				$cat[description]			</div>";		}		elseif($cat[id] != "")		{			$this->list_products .="			<div class='product_sort'>Показать по: ";			if($_COOKIE["product_count"] == "30" OR $_COOKIE["product_count"] == "")			{				$product_count_30 = "active";			}			elseif($_COOKIE["product_count"] == "60")			{				$product_count_60 = "active";			}			elseif($_COOKIE["product_count"] == "90")			{				$product_count_90 = "active";			}			$this->list_products .="<span class='product_count $product_count_30'>30</span> <span class='product_count $product_count_60'>60</span> <span class='product_count $product_count_90'>90</span>";			$this->list_products .="			<div style='float:right;'>Сортировать по: ";			if($_COOKIE["product_order_by"] == "all" OR $_COOKIE["product_order_by"] == "")			{				$product_count_all = "active";			}			elseif($_COOKIE["product_order_by"] == "prise")			{				$product_count_prise = "active";			}			elseif($_COOKIE["product_order_by"] == "title")			{				$product_count_title = "active";			}			$this->list_products .="<span class='product_order_by $product_count_prise' value='prise'>цене</span> <span class='product_order_by $product_count_title' value='title'>названию</span> <span class='product_order_by $product_count_all' value='all'>все подряд</span>			</div>			</div>";									//Запрос и страницы			$stipulation = " AND (category = '$cat[id]' OR category2 = '$cat[id]' OR category3 = '$cat[id]'";			$children_cats = mysql_query("SELECT * FROM category WHERE parent='$cat[id]'");			if(mysql_num_rows($children_cats) > 0)			{				while($child = mysql_fetch_array($children_cats))				{					$stipulation .= " OR category = '$child[id]' OR category2 = '$child[id]' OR category3 = '$child[id]'";				}			}			$stipulation .= ")";						/* ФИЛЬТРЫ */			if($_GET[filter] != "")			{				$filter = explode(";", $_GET[filter]);				for($i=0; $i < count($filter)-1; $i++)				{					$value = explode("=", $filter[$i]);					if($value[0] != "" AND $value[1] != "")					{						$filters_stipulation = "";						//$this->list_products .="$value[0] = $value[1] ";						$filter_elements = explode(",", $value[1]);						if($filter_elements[1] != "")						{							$filters_stipulation .= " (filter='$value[0]' AND (";							for($a=0; $a < count($filter_elements); $a++)							{								if($a == 0)								{									$filters_stipulation .= "element='".$filter_elements[$a]."'";								}								else								{									$filters_stipulation .= " OR element='".$filter_elements[$a]."'";								}							}						$filters_stipulation .= "))";						}						else						{							$filters_stipulation .= " (filter='$value[0]' AND element='$value[1]')";						}												if($filters_array != "")						{							$filters_stipulation .= " AND product_type IN (".$filters_array.")";						}						$filters_array = "";						$filters_query = mysql_query("SELECT product_type FROM filter_products WHERE ".$filters_stipulation);						while(@$filters = mysql_fetch_array($filters_query))						{							if($filters_array != "")							{								$filters_array .= ", ";							}							$filters_array .= $filters[product_type];						}						//$this->list_products .="<p>$filters_stipulation - $filters_array</p>";					}				}				$stipulation .= " AND id IN (".$filters_array.")";			}						/* Цена */			if($_COOKIE["prise_from"] != "" AND $_COOKIE["prise_to"] != "")			{				/*				$prise_query = mysql_query("SELECT product_type FROM products WHERE prise > ".$_COOKIE["prise_from"]." AND prise < ".$_COOKIE["prise_to"]);				while(@$prises = mysql_fetch_array($prise_query))				{					if($prises_array != "")					{						$prises_array .= ", ";					}					$prises_array .= $prises[product_type];				}				$stipulation .= " AND id IN (".$prises_array.")";				*/				$stipulation .= " AND prise >= ".$_COOKIE["prise_from"]." AND prise <= ".$_COOKIE["prise_to"];			}						/* Если пользователь не админ - показывать только видимые товары */			if($_SESSION['user_type'] != 3 AND $_SESSION[user_type] != 2)			{				$stipulation .= " AND product_types.vision='1'";			}						/* Сортировка */			if($_COOKIE["product_count"] != "")			{				$limit = $_COOKIE["product_count"];			}			else			{				$limit = $this->products_on_str;			}					$query = mysql_query("SELECT id FROM product_types WHERE (1=1)".$stipulation);			@$num_rows_str = mysql_num_rows($query);				if($num_rows_str > 0)			{			//Сторінки			$str = $_GET[str];			$total = ceil($num_rows_str / $limit);			if(empty($str) or $str < 0) { $str = 1; }			if($str > $total) { $str = $total; }			$str_start = $str * $limit - $limit;						$storinka = "/catalog/$_GET[id]/$_GET[category].html";			if($total < 3 )			{				$pervstr = ""; $nextstr = "";			}			else			{				// Проверяем нужны ли стрелки назад 				if ($str > 4) $pervstr = "<a href='".$storinka."'>1</a> ...";				// Проверяем нужны ли стрелки вперед 				if ( $str >= $total - 5) $nextstr = "";				elseif ($str != $total) $nextstr = "... <a href='".$storinka."/".$total."'>".$total."</a>"; 			}			// Находим дві ближайшие станицы с обоих краев, если они есть			if($str - 6 > 0) $str6left = '<a href='.$storinka.'/'. ($str - 6) .'>'. ($str - 6) .'</a>'; 			if($str - 5 > 0) $str5left = '<a href='.$storinka.'/'. ($str - 5) .'>'. ($str - 5) .'</a>'; 			if($str - 4 > 0) $str4left = '<a href='.$storinka.'/'. ($str - 4) .'>'. ($str - 4) .'</a>'; 			if($str - 3 > 0) $str3left = '<a href='.$storinka.'/'. ($str - 3) .'>'. ($str - 3) .'</a>'; 			if($str - 2 > 0) $str2left = '<a href='.$storinka.'/'. ($str - 2) .'>'. ($str - 2) .'</a>'; 			if($str - 1 > 0 AND $str - 1 > 1) { $str1left = '<a href='.$storinka.'/'. ($str - 1) .'>'. ($str - 1) .'</a>'; }			elseif($str - 1 > 0) { $str1left = '<a href='.$storinka.'>'. ($str - 1) .'</a>'; }			if($str + 1 <= $total) $str1right = '<a href='.$storinka.'/'. ($str + 1) .'>'. ($str + 1) .'</a>';			if($str + 2 <= $total) $str2right = '<a href='.$storinka.'/'. ($str + 2) .'>'. ($str + 2) .'</a>';			if($str + 3 <= $total) $str3right = '<a href='.$storinka.'/'. ($str + 3) .'>'. ($str + 3) .'</a>';			if($str + 4 <= $total) $str4right = '<a href='.$storinka.'/'. ($str + 4) .'>'. ($str + 4) .'</a>';			if($str + 5 <= $total) $str5right = '<a href='.$storinka.'/'. ($str + 5) .'>'. ($str + 5) .'</a>';			if($str + 6 <= $total) $str6right = '<a href='.$storinka.'/'. ($str + 6) .'>'. ($str + 6) .'</a>';						if($total > 1)			{			$this->str_list_products = "<div class='pages'> $pervstr";			if($str == $total) $this->str_list_products .= "$str6left $str5left $str4left";			if($str == $total-1) $this->str_list_products .= "$str5left $str4left";			if($str == $total-2) $this->str_list_products .= "$str4left";			$this->str_list_products .= " ".$str3left." ".$str2left." ".$str1left." <span>".$str."</span> ".$str1right." ".$str2right." ".$str3right." ";			if($str == 1) $this->str_list_products .= " $str4right $str5right $str6right";			if($str == 2) $this->str_list_products .= " $str4right $str5right";			if($str == 3) $this->str_list_products .= " $str4right";			$this->str_list_products .= " ".$nextstr."</div>";			}			/* Сортировка */			if($_COOKIE["product_order_by"] != "" AND $_COOKIE["product_order_by"] != "all")			{				$sort = "ORDER by ".$_COOKIE["product_order_by"]."";			}			else			{				$sort = "ORDER by datetime desc";			}						$query = mysql_query("SELECT * FROM product_types WHERE (1=1)".$stipulation." ".$sort." LIMIT $str_start, $limit");			$this->list_products .="<h1>$cat[title]</h1>			<div style='vertical-align:top;'>";			if(mysql_num_rows($query) > 0)			{				while($array = mysql_fetch_array($query))				{					$product = mysql_fetch_array(mysql_query("SELECT prise FROM products WHERE product_type='$array[id]' ORDER by prise LIMIT 1"));					$eng_title = str_replace(" ", "_", $array[eng_title]);					//$this->list_products .="<div class='mini_two_goods'>					//<div class='left_side'>";					$this->list_products .="<div class='mini_cat'>					<div class='mini_cat_image'>";					if(file_exists("images/products/$array[id]/general-115x115.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-115x115.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("images/products/$array[id]/general-350x350.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-350x350.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("images/products/$array[id]/general-full.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-full.jpg' alt='$array[title]'></a>";					}					$this->list_products .="					</div>					<div class='mini_cat_title'><a href='/product/$array[id]/$eng_title.html'>$array[title]</a></div>					<div class='mini_cat_category'><a href='/catalog/$cat[id]/$cat[eng_title].html'>$cat[title]</a></div>					<div class='mini_cat_prise'>от: <b>$product[prise]</b> руб.</div>";					//$this->list_products .= "<div class='mini_cat_title'><a href='/product/$array[id]/$eng_title.html'>$array[title]</a></div>";					//$this->list_products .="<p>Цена: $array[new_prise] руб.</p>";					//$this->list_products .= $this->button_buy($array[id]).					$this->list_products .="					</div>";										//$this->list_products .="</div>";				}			}			}			$this->list_products .= $this->str_list_products;			$this->list_products .="			<div class='cat_description'>				$cat[description]			</div>			";		}	}		else	{		$cats = mysql_query("SELECT * FROM category WHERE parent='0' AND vision='1'");		while($array_cats = mysql_fetch_array($cats))		{			$this->list_products .="<div class='mini_cat'>				<div class='mini_cat_image' style='background-image:url(/images/catalog/$array_cats[id]/$array_cats[eng_title]-135x135.jpg);'>					<a class='big_a' href='/catalog/$array_cats[id]/$array_cats[eng_title].html' rel='nofollow'></a>				</div>				<div class='mini_cat_title'><a href='/catalog/$array_cats[id]/$array_cats[eng_title].html'>$array_cats[title]</a></div>			</div>";		}	}}function get_one_product(){	if($_GET[id] == "" AND $_GET[title] != "")	{		$product = mysql_fetch_array(mysql_query("SELECT id FROM product_types WHERE eng_title='$_GET[title]'"));		if($product[id] != "")		{			$_GET[id] = $product[id];		}	}		if($_GET[id] != "")	{		//$eng_title = str_replace("_", " ", $_GET[title]);		//$sql = "SELECT * FROM product_types WHERE eng_title='".$eng_title."'";		$_GET[id] = preg_replace('~[^0-9]+~u', '', $_GET[id]);		$sql = "SELECT * FROM product_types WHERE id='".$_GET[id]."'";		if($_SESSION['user_type'] != 3 AND $_SESSION[user_type] != 2)		{			$sql .= " AND vision='1'";		}		$query = mysql_query($sql);		if(mysql_num_rows($query) > 0)		{			$array = mysql_fetch_array($query);			if($array[eng_title] != $_GET[title])			{				header("location: /product/".$_GET[id]."/".$array[eng_title].".html");			}			else			{						$this->one_product .="			<h1>$array[title]</h1>			<div style='overflow:hidden;'>			<div class='left_side'>";			if(file_exists("images/products/$array[id]/general-350x350.jpg"))			{				$this->one_product .="<a class='fancybox-thumbs' rel='ad_images' href='/images/products/$array[id]/general-full.jpg'><img class='central_img' src='/images/products/$array[id]/general-350x350.jpg' alt='$array[title]'></a>";			}			elseif(file_exists("images/products/$array[id]/$array[image]-full.jpg"))			{				$this->one_product .="<a class='fancybox-thumbs' rel='ad_images' href='/images/products/$array[id]/general-full.jpg'><img class='central_img' src='/images/products/$array[id]/general-full.jpg' alt='$array[title]'></a>";			}						/*			$ad_images_query = mysql_query("SELECT * FROM goods_images WHERE good='$array[id]'");			if(mysql_num_rows($ad_images_query) > 0)			{			$this->one_product .="<div class='additional_images'>";						while($ad_images_array = mysql_fetch_array($ad_images_query))			{				$this->one_product .="<div>";				if(file_exists("images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-45x45.jpg"))				{					$this->one_product .="<a class='fancybox-thumbs' rel='ad_images' href='/images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-full.jpg'><img class='central_img' src='/images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-45x45.jpg' alt='$array[title]'></a>";				}				elseif(file_exists("images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-full.jpg"))				{					$this->one_product .="<a class='fancybox-thumbs' rel='ad_images' href='/images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-full.jpg'><img class='central_img' src='/images/products/$array[id]/$ad_images_array[name]-$ad_images_array[id]-full.jpg' alt='$array[title]'></a>";				}								if($_SESSION['user_type'] == 3)				{					$this->one_product .="<p class='del_addition_image link' image='$ad_images_array[id]'>X</p>";				}				$this->one_product .="</div>";			}			$this->one_product .="</div>";						}			*/			$this->one_product .="			</div>			<div class='right_side'>			<div>			".$this->this_product[mini_description]."			</div>";						if($_SESSION['user_type'] == 2 OR $_SESSION['user_type'] == 3)			{				$this->one_product .="				<p><a href='/red_product/$array[id].html'>Редактировать</a></p>";				//$this->one_product .="<p><a href='/del_product/$array[id]' onclick='return confirm(\"Точно удалить?\");'>Удалить</a></p>";			}			$this->one_product .="				<div style='margin-top:10px;' class='yashare-auto-init' data-yashareL10n='ru' data-yasharetheme='counter' data-yashareType='big' data-yashareQuickServices='vkontakte,facebook,twitter,odnoklassniki,moimir,gplus'></div> 			</div>							<div class='fast-buy'>                    <div class='fast-title'><span class='light-gray'>Купить:&nbsp;</span>$array[title]<span class='red'>&nbsp;в один клик!</span></div>                    <div>						<form action='' method='post'>                        <input name='name' placeholder='ВАШЕ ИМЯ' type='text'>&nbsp;&nbsp;                        <input name='phone' placeholder='ТЕЛЕФОН' type='text'>&nbsp;&nbsp;                        <input name='product_id' value='".$array[id]."' type='hidden'>                        <input type='submit' class='blue_button fast-go' name='callback_send' value='БЫСТРЫЙ ЗАКАЗ'>						<br />						<br />                        <a href='#' class='fast-comment-link'>Добавить комментарий к заказу</a>						<br />                        <textarea class='fast-comment' name='text'></textarea>						</form>                    </div>                </div>			</div>";						$query_product = mysql_query("SELECT * FROM products WHERE product_type='".$this->this_product[id]."'");			if(mysql_num_rows($query_product) > 0)			{				$this->one_product .="<form action='' method='post'>				<table class='products'>				<tr class='title_tr'>				<td>Код товара</td> <td>Имя</td> <td>Цена</td> <td>Количество</td>";				if($_SESSION['user_type'] == 2 OR $_SESSION['user_type'] == 3)					{						$this->one_product .=" <td></td>";					}				$this->one_product .="</tr>";				while($array_product = mysql_fetch_array($query_product))				{					$this->one_product .="<tr><td>$array_product[code]</td> <td>$array_product[title]</td> <td>";					if($_SESSION['user_type'] == 2 OR $_SESSION['user_type'] == 3)					{						$this->one_product .="<span class='product_prise' product_id='$array_product[id]'>$array_product[prise]</span>";					}					else					{						$this->one_product .="<span>$array_product[prise]</span>";					}					$this->one_product .=" руб.</td> <td><input type='hidden' name='product_id[]' value='$array_product[id]'> <input type='text' class='product_count' name='count[]' size='3' value='0'>					";					if($_SESSION['user_type'] == 2 OR $_SESSION['user_type'] == 3)					{						$this->one_product .="</td> <td align='center'><a href='#' class='fast_del_product fast_delete' product_id='$array_product[id]' title='Удалить'></a>";					}					$this->one_product .="</td></tr>					";				}								$this->one_product .="</table>";				//if($_SESSION[user] != "")				//{					$this->one_product .="<div class='on_cart'><input type='submit' name='add_cart' value='В корзину'></div>";				//}				//else				//{				//	$this->one_product .="<div class='on_cart'><input type='button' name='add_cart' value='В корзину' onclick='alert(\"Для заказа вы должны быть авторизированы\");'></div>";				//}				$this->one_product .="</form>";			}			$this->one_product .="			<div class='section'>			<ul class='tabs product_style'>				<li class='current'>Характеристики</li>				<li>Описание</li>			</ul>			<div class='box visible'>";			$stats = explode("\r\n", $array[stats]);			if($stats != "")			{				$this->one_product .="<div class='stats'>				<div class='left'>";				$stats_count = count($stats);				for($i=0; $i<ceil($stats_count/2); $i++)				{					$stat = explode(":", $stats[$i]);										$this->one_product .="<div class='stat'>					<span class='stat_title'>$stat[0]</span>					<span class='stat_value'>$stat[1]</span>					</div>";				}				$this->one_product .="</div>				<div class='right'>";				for($i=$i; $i<$stats_count; $i++)				{					$stat = explode(":", $stats[$i]);										$this->one_product .="<div class='stat'>					<span class='stat_title'>$stat[0]</span>					<span class='stat_value'>$stat[1]</span>					</div>";				}				$this->one_product .="</div>				</div>";			}			$this->one_product .="</div>				<div class='box'>					$array[description]				</div>			</div>			";						$relative_product_query = mysql_query("SELECT * FROM related_products WHERE product_type1='".$this->this_product[id]."'");			if(mysql_num_rows($relative_product_query) > 0)			{				$this->one_product .="<div class='relative_products'>				<h2>С этим Товаром покупают</h2>				<a href='#' class='jcarousel-control-prev'>&lsaquo;</a>				<a href='#' class='jcarousel-control-next'>&rsaquo;</a>				<div class='jcarousel-wrapper'>				<div class='jcarousel'>				<ul>";				while($relative_product_array = mysql_fetch_array($relative_product_query))				{					$array = mysql_fetch_array(mysql_query("SELECT * FROM product_types WHERE id='$relative_product_array[product_type2]'"));					$prise = mysql_fetch_array(mysql_query("SELECT prise FROM products WHERE product_type='$array[id]' ORDER by prise LIMIT 1"));					$this->one_product .="<li><a href='/product/$array[id]/$array[eng_title].html' rel='nofollow'><img src='/images/products/$array[id]/general-115x115.jpg'></a>					<br /><a href='/product/$array[id]/$array[eng_title].html'><b>$array[title]</b></a>					<br /><span style='color:blue;'>от <b>$prise[prise]</b> руб.</span></li>";				}				$this->one_product .="</ul>				</div>				</div>";			}						}		}		else		{			$this->one_product .= "<h1>Товара по вашему запросу не найдено</h1>";		}	}	else	{		$this->one_product .= "<h1>Товара по вашему запросу не найдено</h1>";	}}function search($text = ""){	$new_text = explode(" ", $text);	for($i=0; $i<count($new_text); $i++)	{		$stipulation .= " AND (title LIKE '%".$new_text[$i]."%' OR eng_title LIKE '%".$new_text[$i]."%' OR description LIKE '%".$new_text[$i]."%')";	}	$query = mysql_query("SELECT * FROM product_types WHERE (1=1)".$stipulation." ORDER by title");			if(mysql_num_rows($query) > 0)			{				while($array = mysql_fetch_array($query))				{					$product = mysql_fetch_array(mysql_query("SELECT prise FROM products WHERE product_type='$array[id]' ORDER by prise LIMIT 1"));					$category = mysql_fetch_array(mysql_query("SELECT id, title, eng_title FROM category WHERE id='$array[category]'"));					$eng_title = str_replace(" ", "_", $array[eng_title]);					//$this->list_products .="<div class='mini_two_goods'>					//<div class='left_side'>";					$this->list_products .="<div class='mini_cat'>					<div class='mini_cat_image'>";					if(file_exists("images/products/$array[id]/general-115x115.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-115x115.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("images/products/$array[id]/general-350x350.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-350x350.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("images/products/$array[id]/general-full.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-full.jpg' alt='$array[title]'></a>";					}					$this->list_products .="					</div>					<div class='mini_cat_title'><a href='/product/$array[id]/$eng_title.html'>$array[title]</a></div>					<div class='mini_cat_category'><a href='/catalog/$category[id]/$category[eng_title].html'>$category[title]</a></div>					<div class='mini_cat_prise'>от: <b>$product[prise]</b> руб.</div>";					//$this->list_products .= $this->button_buy($array[id]).					$this->list_products .="					</div>";										//$this->list_products .="</div>";				}			}}function get_filters($category = ""){	$query = mysql_query("SELECT * FROM filter_cats WHERE category='$category'");	while($array = mysql_fetch_array($query))	{@		$filter = mysql_fetch_array(mysql_query("SELECT * FROM filter WHERE id='$array[filter]'"));@		$elements_query = mysql_query("SELECT * FROM filter_elements WHERE filter='$filter[id]'");		if($filter[id] != "" AND mysql_num_rows($elements_query) > 0)		{			$this->filter_list .= "			<div class='filter_cat'>			<p><b>$filter[title]</b></p>";			while($elements = mysql_fetch_array($elements_query))			{				$filter_url = $_GET[filter];				if(eregi("$filter[id]=$elements[id];", $filter_url))				{					$filter_url = ereg_replace("$filter[id]=$elements[id];", "", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url' checked> $elements[title]<br />";				}				elseif(eregi("$filter[id]=$elements[id],([0-9,]*);", $filter_url))				{					$filter_url = preg_replace("/$filter[id]=$elements[id],([0-9,]*);/i", "$filter[id]=$1;", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url' checked> $elements[title]<br />";				}				/*				elseif(eregi("$filter[id]=([0-9,]*)$elements[id]([0-9,]*);", $filter_url))				{					$filter_url = preg_replace("/$filter[id]=([0-9,]*),$elements[id]([0-9,]*);/i", "$filter[id]=$1$2;", $filter_url);					$filter_url = preg_replace("/$filter[id]=([0-9,]*)$elements[id]([0-9,]*);/i", "$filter[id]=$1$2;", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url' checked> $elements[title]<br />";				}				*/				elseif(eregi("$filter[id]=([0-9,]*),$elements[id]([0-9,]*);", $filter_url))				{					$filter_url = preg_replace("/$filter[id]=([0-9,]*),$elements[id]([0-9,]*);/i", "$filter[id]=$1$2;", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url' checked> $elements[title]<br />";				}				elseif(eregi("$filter[id]=([0-9,]+);", $filter_url))				{					$filter_url = preg_replace("/$filter[id]=([0-9,]+);/i", "$filter[id]=$1,$elements[id];", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url'> $elements[title]<br />";				}				else				{					$filter_url = $filter_url."$filter[id]=$elements[id];";					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url'> $elements[title]<br />";				}				/*				if(eregi("$filter[id]=$elements[id];", $filter_url))				{					$filter_url = ereg_replace("$filter[id]=$elements[id];", "", $filter_url);					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url' checked> $elements[title]<br />";				}				else				{					$filter_url = $filter_url."$filter[id]=$elements[id];";					$this->filter_list .= "					<input type='checkbox' name='$filter[id]' value='$elements[id]' href='/catalog/$category/$_GET[category].html?filter=$filter_url'> $elements[title]<br />";				}				*/			}			$this->filter_list .= "			</div>";		}	}	$filter_url = $filter_url.";prise=$elements[id];";	$this->filter_list .= "	<div style='width: 98%'>	<form action='' method='post'>		<label for='amount'>Цена (руб.):</label><br />		От <input type='text' name='prise_from' id='prise_from' size='5'> до <input type='text' name='prise_to' id='prise_to' size='5'><br />		<input type='text' id='amount' readonly style='border:0; color:#f6931f; font-weight:bold;'>		<p id='slider'></p>		<input type='submit' name='filters_submit' value='OK' href='/catalog/$category/$_GET[category].html?filter=$filter_url'>	</div>	</form>		";}function create_filter_select($filter = ""){	$this->filter_select .= "	<option value=''></option>";	$query = mysql_query("SELECT * FROM filter ORDER by title");	while($array = mysql_fetch_array($query))	{		if($array[id] == $filter)		{			$this->filter_select .= "			<option value='$array[id]' selected>$array[title]</option>";		}		else		{			$this->filter_select .= "			<option value='$array[id]'>$array[title]</option>";		}			$this->filter_elements_select .="<optgroup label='$array[title]'>";			$query2 = mysql_query("SELECT * FROM filter_elements WHERE filter='$array[id]'");			while($array2 = mysql_fetch_array($query2))			{				$this->filter_elements_select .="				<option value='$array2[id]'>$array2[title]</option>";			}			$this->filter_elements_select .="			</optgroup>";	}	//return $this->filter_select;}function create_admin_list_product(){	if($_POST[product_articul_search] != "")	{		$query = mysql_query("SELECT * FROM products WHERE code='".$_POST[product_articul]."' OR title LIKE '%".$_POST[product_articul]."%'");		if(mysql_num_rows($query))		{		while($array = mysql_fetch_array($query))		{			$product_type = mysql_fetch_array(mysql_query("SELECT * FROM product_types WHERE id='$array[product_type]'"));			$eng_title = str_replace(" ", "_", $product_type[eng_title]);			$this->list_products .="<div class='mini_cat'>			<div class='tools'><a href='red_product/$product_type[id].html' class='config' title='редактировать'></a> <a href='del_product' class='remove' title='Удалить'></a></div>			<div class='mini_cat_image'>";			if(file_exists("../images/products/$product_type[id]/general-115x115.jpg"))			{				$this->list_products .="<a class='big_a' href='/product/$product_type[id]/$eng_title.html'><img src='/images/products/$product_type[id]/general-115x115.jpg' alt='$product_type[title]'></a>";			}			elseif(file_exists("../images/products/$product_type[id]/general-350x350.jpg"))			{				$this->list_products .="<a class='big_a' href='/product/$product_type[id]/$eng_title.html'><img src='/images/products/$product_type[id]/general-350x350.jpg' alt='$product_type[title]'></a>";			}			elseif(file_exists("../images/products/$product_type[id]/general-full.jpg"))			{				$this->list_products .="<a class='big_a' href='/product/$product_type[id]/$eng_title.html'><img src='/images/products/$product_type[id]/general-full.jpg' alt='$product_type[title]'></a>";			}			$this->list_products .="			</div>			<div class='mini_cat_title'><a href='/product/$product_type[id]/$eng_title.html'>$product_type[title]</a></div>			</div>";		}		}		else		{			$this->list_products .="<div class='error_msg'>По вашему запросу нету результатов</div>";		}	}	elseif($_GET[id] != "")	{		$cat = mysql_fetch_array(mysql_query("SELECT * FROM category WHERE id='$_GET[id]'"));		if($cat[id] != "" AND $cat['parent'] == 0)		{			$this->list_products .="<h1>$cat[title]</h1>";			$children_cats = mysql_query("SELECT * FROM category WHERE parent='$cat[id]' AND vision='1'");			while($child = mysql_fetch_array($children_cats))			{				$this->list_products .="<div class='mini_cat'>					<div class='mini_cat_image' style='background-image:url(/images/catalog/$child[id]/$child[eng_title]-135x135.jpg);'>						<a class='big_a' href='product_list/$child[id]/$child[eng_title].html' rel='nofollow'></a>					</div>					<div class='mini_cat_title'><a href='product_list/$child[id]/$child[eng_title].html'>$child[title]</a></div>				</div>";			}		}		elseif($cat[id] != "")		{			//Запрос и страницы			$stipulation = " AND (category = '$cat[id]' OR category2 = '$cat[id]' OR category3 = '$cat[id]'";			$children_cats = mysql_query("SELECT * FROM category WHERE parent='$cat[id]'");			if(mysql_num_rows($children_cats) > 0)			{				while($child = mysql_fetch_array($children_cats))				{					$stipulation .= " OR category = '$child[id]' OR category2 = '$child[id]' OR category3 = '$child[id]'";				}			}			$stipulation .= ")";					$query = mysql_query("SELECT id FROM product_types WHERE (1=1)".$stipulation);			@$num_rows_str = mysql_num_rows($query);				if($num_rows_str > 0)			{			//Сторінки			$str = $_GET[str];			$total = ceil($num_rows_str / $this->products_on_str);			if(empty($str) or $str < 0) { $str = 1; }			if($str > $total) { $str = $total; }			$str_start = $str * $this->products_on_str - $this->products_on_str;						$storinka = "product_list/$_GET[id]/$_GET[category].html";			if($total < 3 )			{				$pervstr = ""; $nextstr = "";			}			else			{				// Проверяем нужны ли стрелки назад 				if ($str > 4) $pervstr = "<a href='".$storinka."'>1</a> ...";				// Проверяем нужны ли стрелки вперед 				if ( $str >= $total - 5) $nextstr = "";				elseif ($str != $total) $nextstr = "... <a href='".$storinka."/".$total."'>".$total."</a>"; 			}			// Находим дві ближайшие станицы с обоих краев, если они есть			if($str - 6 > 0) $str6left = '<a href='.$storinka.'/'. ($str - 6) .'>'. ($str - 6) .'</a>'; 			if($str - 5 > 0) $str5left = '<a href='.$storinka.'/'. ($str - 5) .'>'. ($str - 5) .'</a>'; 			if($str - 4 > 0) $str4left = '<a href='.$storinka.'/'. ($str - 4) .'>'. ($str - 4) .'</a>'; 			if($str - 3 > 0) $str3left = '<a href='.$storinka.'/'. ($str - 3) .'>'. ($str - 3) .'</a>'; 			if($str - 2 > 0) $str2left = '<a href='.$storinka.'/'. ($str - 2) .'>'. ($str - 2) .'</a>'; 			if($str - 1 > 0 AND $str - 1 > 1) { $str1left = '<a href='.$storinka.'/'. ($str - 1) .'>'. ($str - 1) .'</a>'; }			elseif($str - 1 > 0) { $str1left = '<a href='.$storinka.'>'. ($str - 1) .'</a>'; }			if($str + 1 <= $total) $str1right = '<a href='.$storinka.'/'. ($str + 1) .'>'. ($str + 1) .'</a>';			if($str + 2 <= $total) $str2right = '<a href='.$storinka.'/'. ($str + 2) .'>'. ($str + 2) .'</a>';			if($str + 3 <= $total) $str3right = '<a href='.$storinka.'/'. ($str + 3) .'>'. ($str + 3) .'</a>';			if($str + 4 <= $total) $str4right = '<a href='.$storinka.'/'. ($str + 4) .'>'. ($str + 4) .'</a>';			if($str + 5 <= $total) $str5right = '<a href='.$storinka.'/'. ($str + 5) .'>'. ($str + 5) .'</a>';			if($str + 6 <= $total) $str6right = '<a href='.$storinka.'/'. ($str + 6) .'>'. ($str + 6) .'</a>';						$this->str_list_products = "<div class='pages'> $pervstr";			if($str == $total) $this->str_list_products .= "$str6left $str5left $str4left";			if($str == $total-1) $this->str_list_products .= "$str5left $str4left";			if($str == $total-2) $this->str_list_products .= "$str4left";			$this->str_list_products .= " ".$str3left." ".$str2left." ".$str1left." <span>".$str."</span> ".$str1right." ".$str2right." ".$str3right." ";			if($str == 1) $this->str_list_products .= " $str4right $str5right $str6right";			if($str == 2) $this->str_list_products .= " $str4right $str5right";			if($str == 3) $this->str_list_products .= " $str4right";			$this->str_list_products .= " ".$nextstr."</div>";			$query = mysql_query("SELECT * FROM product_types WHERE (1=1)".$stipulation." ORDER by datetime desc LIMIT $str_start, $this->products_on_str");			$this->list_products .="<h1>$cat[title]</h1>			<div style='vertical-align:top;'>";			if(mysql_num_rows($query) > 0)			{				while($array = mysql_fetch_array($query))				{					$eng_title = str_replace(" ", "_", $array[eng_title]);					//$this->list_products .="<div class='mini_two_goods'>					//<div class='left_side'>";					$this->list_products .="<div class='mini_cat'>					<div class='tools'><a href='red_product/$array[id].html' class='config' title='редактировать'></a> <a href='del_product' class='remove' title='Удалить'></a></div>					<div class='mini_cat_image'>";					if(file_exists("../images/products/$array[id]/general-115x115.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-115x115.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("../images/products/$array[id]/general-350x350.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-350x350.jpg' alt='$array[title]'></a>";					}					elseif(file_exists("../images/products/$array[id]/general-full.jpg"))					{						$this->list_products .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-full.jpg' alt='$array[title]'></a>";					}					$this->list_products .="					</div>					<div class='mini_cat_title'><a href='/product/$array[id]/$eng_title.html'>$array[title]</a></div>					</div>";										//$this->list_products .="</div>";				}			}			}			/*			$this->list_products .="			<div class='cat_description'>				$cat[description]			</div>			";			*/		}	}	else	{		$cats = mysql_query("SELECT * FROM category WHERE parent='0' AND vision='1'");		while($array_cats = mysql_fetch_array($cats))		{			$this->list_products .="<div class='mini_cat'>				<div class='mini_cat_image' style='background-image:url(/images/catalog/$array_cats[id]/$array_cats[eng_title]-135x135.jpg);'>					<a class='big_a' href='product_list/$array_cats[id]/$array_cats[eng_title].html' rel='nofollow'></a>				</div>				<div class='mini_cat_title'><a href='product_list/$array_cats[id]/$array_cats[eng_title].html'>$array_cats[title]</a></div>			</div>";		}	}}function create_index_list_product(){	$query = mysql_query("SELECT * FROM product_types ORDER by RAND() LIMIT 4");	while($array = mysql_fetch_array($query))	{		$product = mysql_fetch_array(mysql_query("SELECT prise FROM products WHERE product_type='$array[id]' ORDER by prise LIMIT 1"));		$eng_title = str_replace(" ", "_", $array[eng_title]);		$this->index_list_product .="<div class='mini_cat'>		<div class='mini_cat_image'>";		if(file_exists("images/products/$array[id]/general-115x115.jpg"))		{			$this->index_list_product .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-115x115.jpg' alt='$array[title]'></a>";		}		elseif(file_exists("images/products/$array[id]/general-350x350.jpg"))		{			$this->index_list_product .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-350x350.jpg' alt='$array[title]'></a>";		}		elseif(file_exists("images/products/$array[id]/general-full.jpg"))		{			$this->index_list_product .="<a class='big_a' href='/product/$array[id]/$eng_title.html'><img src='/images/products/$array[id]/general-full.jpg' alt='$array[title]'></a>";		}		$this->index_list_product .="		</div>		<div class='mini_cat_title'><a href='/product/$array[id]/$eng_title.html'>$array[title]</a></div>		<div class='mini_cat_category'><a href='/catalog/$cat[id]/$cat[eng_title].html'>$cat[title]</a></div>		<div class='mini_cat_prise'>от: <b>$product[prise]</b> руб.</div>";		$this->index_list_product .="		</div>";	}}function write_prises(){	$query = mysql_query("SELECT id, prise FROM product_types");	while($array = mysql_fetch_array($query))	{		$query2 = mysql_query("SELECT prise FROM products WHERE product_type='$array[id]' ORDER by prise asc LIMIT 1");		while($array2 = mysql_fetch_array($query2))		{			if($array[prise] != $array2[prise])			{				mysql_query("UPDATE product_types SET prise='$array2[prise]' WHERE id='$array[id]'");			}		}	}}function delete_cookie(){	SetCookie("prise_from","");	SetCookie("prise_to","");}}